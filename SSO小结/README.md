### 1.什么是SSO？

SSO（ Single Sign-On ），中文意即单点登录，单点登录是一种控制多个相关但彼此独立的系统的访问权限，拥有这一权限的用户可以使用单一的ID和密码访问某个或多个系统从而避免使用不同的用户名或密码，或者通过某种配置无缝地登录每个系统。

SSO的一种较为通俗的定义是：SSO是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。它包括可以将这次主要的登录映射到其他应用中用于同一个用户的登录的机制。它是目前比较流行的企业业务整合的解决方案之一。

***单点登录包含三个核心元素，即：用户、系统、验证中心***

[![DUGzPU.png](https://s3.ax1x.com/2020/11/25/DUGzPU.png)](https://imgchr.com/i/DUGzPU)

<u>后来，我们为了合理利用资源和降低耦合性，于是把单系统拆分成多个子系统。</u>

[![DUJp24.png](https://s3.ax1x.com/2020/11/25/DUJp24.png)](https://imgchr.com/i/DUJp24)

### 	2.技术实现机制

当用户第一次访问应用系统的时候，因为还没有登录，会被引导到认证系统中进行登录；根据用户提供的登录信息，认证系统进行身份校验，如果通过校验，应该返回给用户一个认证的凭据－－ticket；用户再访问别的应用的时候，就会将这个ticket带上，作为自己认证的凭据，应用系统接受到请求之后会把ticket送到认证系统进行校验，检查ticket的合法性。如果通过校验，用户就可以在不用再次登录的情况下访问应用系统2和应用系统3了。

要实现SSO，需要以下主要的功能：

- 所有应用系统共享一个身份认证系统。　　统一的认证系统是SSO的前提之一。认证系统的主要功能是将用户的登录信息和用户信息库相比较，对用户进行登录认证；认证成功后，认证系统应该生成统一的认证标志（ticket），返还给用户。另外，认证系统还应该对ticket进行效验，判断其有效性。
- 所有应用系统能够识别和提取ticket信息　　要实现SSO的功能，让用户只登录一次，就必须让应用系统能够识别已经登录过的用户。应用系统应该能对ticket进行识别和提取，通过与认证系统的通讯，能自动判断当前用户是否登录过，从而完成单点登录的功能。

[![DUJuxH.png](https://s3.ax1x.com/2020/11/25/DUJuxH.png)](https://imgchr.com/i/DUJuxH)

### 3.实现

<img src="https://img2018.cnblogs.com/blog/1104426/201908/1104426-20190805193713554-411992100.png">

解决系统之间的 Session 不共享问题有以下几种方案：

- Tomcat集群Session全局复制（集群内每个tomcat的session完全同步）【会影响集群的性能呢，不建议】
- 根据请求的IP进行Hash映射到对应的机器上（这就相当于请求的IP一直会访问同一个服务器)
- 把Session数据放在Redis中（使用Redis模拟Session）

我们可以将登录功能单独抽取出来，做成一个子系统。

<img src="https://img2018.cnblogs.com/blog/1104426/201908/1104426-20190805193736958-490044007.png">

阿里系的淘宝和天猫，很明显地我们可以知道这是两个系统，但是你在使用的时候，登录了天猫，淘宝也会自动登录。

<img src="https://img2018.cnblogs.com/blog/1104426/201908/1104426-20190805193627174-935516250.png">

**SSO（登录系统）的逻辑如下：**

- SSO系统生成一个token，并将用户信息存到Redis中，并设置过期时间
- 其他系统请求SSO系统进行登录，得到SSO返回的token，写到Cookie中
- 每次请求时，Cookie都会带上，拦截器得到token，判断是否已经登录

**至此，其实我们会发现其实就两个变化：**

- 将登陆功能抽取为一个系统（SSO），其他系统请求SSO进行登录
- 本来将用户信息存到Session，现在将用户信息存到Redis。

##### 单系统登录功能主要是用 Session 保存用户信息来实现的，但我们清楚的是：多系统即可能有多个 Tomcat，而 Session 是依赖当前系统的 Tomcat，所以系统A 的 Session 和系统B 的 Session 是不共享的。